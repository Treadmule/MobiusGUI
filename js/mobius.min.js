function applySettings(){for(var a=0;a<parameters.length;a++){var b=$("[name="+a+"]");if(b.is("[type=radio]")){var c=$("[name="+a+"]:checked").val();(1==a||3==a)&&(prameterIndex=a+1,4==$("[name="+a+"]:checked").val()&&(c=3,fpsValue=1,changeParameter(prameterIndex,fpsValue)),$("[name="+a+"]:checked").val()<4&&(fpsValue=2,changeParameter(prameterIndex,fpsValue))),changeParameter(a,c)}if(b.is("[type=number]")){var c=b.val();parseInt(b.attr("min"))<=parseInt(c)&&parseInt(c)<=parseInt(b.attr("max"))?changeParameter(a,c):(b.val(defaultParameters[a]),whatswrong=b.closest("div").siblings().text(),alert("One or more values entered for "+whatswrong+"\nare out of the acceptable range.\nI will replace it with the default value.\n\nThe range is: ["+b.attr("min")+";"+b.attr("max")+"]"))}}var d=parseInt($("[name=video1Flip]:checked").val()),e=2*parseInt($("[name=video2Flip]:checked").val()),f=d+e;changeParameter(12,f),SaveSYSCFG()}function displaySettings(){for(var a=0;a<parameters.length;a++)checkMinMax(a),0!=$("[name="+a+"]").length&&($("[name="+a+"]").is("[type=radio]")&&($("[name="+a+"]")[parameters[a]].checked=!0),$("[name="+a+"]").is("[type=number]")&&$("[name="+a+"]").val(parameters[a]));switch(3==parameters[1]&&1==parameters[2]&&($("[name=1]")[4].checked=!0),3==parameters[3]&&1==parameters[4]&&($("[name=3]")[4].checked=!0),parameters[12]){case"0":$("[name=video1Flip]")[0].checked=!0,$("[name=video2Flip]")[0].checked=!0;break;case"1":$("[name=video1Flip]")[1].checked=!0,$("[name=video2Flip]")[0].checked=!0;break;case"2":$("[name=video1Flip]")[0].checked=!0,$("[name=video2Flip]")[1].checked=!0;break;case"3":$("[name=video1Flip]")[1].checked=!0,$("[name=video2Flip]")[1].checked=!0}}function handleFileSelect(a){a.stopPropagation(),a.preventDefault();var b=a.dataTransfer.files,c=b[0],d=new FileReader;d.onloadend=function(a){a.target.readyState==FileReader.DONE&&(SYSCFG=a.target.result,updateParameters(),"v1.13"!=version[0]&&alert("Your firmware is different from version 1.13.\nPlease be carefull as this may, or may not work at all!"),displaySettings())},d.readAsText(c)}function handleDragOver(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}function changeParameter(a,b){var c=0;SYSCFG=SYSCFG.replace(/[^[]+(?=\])/g,function(d){return++c==a+1?b:d})}function SaveSYSCFG(){var a=new Blob([SYSCFG],{type:"text/plain;charset=utf-8"});saveAs(a,"SYSCFG.TXT")}function updateParameters(){parameters=SYSCFG.match(/[^[]+(?=\])/g),version=SYSCFG.match(/v[^{]+(?=\})/g),console.log(version[0])}function checkMinMax(a){switch(maxvalue=10,minvalue=0,a){case 2:case 4:maxvalue=2,minvalue=1;break;case 12:maxvalue=3}0!=$("[name="+a+"]").length&&($("[name="+a+"]").attr("maxval")?(maxvalue=$("[name="+a+"]").attr("maxval"),minvalue=$("[name="+a+"]").attr("minval")):$("[name="+a+"]").attr("max")?(maxvalue=$("[name="+a+"]").attr("max"),minvalue=$("[name="+a+"]").attr("min")):(maxvalue=$("[name="+a+"]").length-1,minvalue=0)),(parameters[a]>maxvalue||parameters[a]<minvalue)&&(parameters[a]=defaultParameters[a],console.log("wrong"+a),alert("One or more parameters from your SYSCFG.TXT file are out of their acceptable range.\nI'll use defaults instead."))}var defaultCFG_URL="syscfg/SYSCFG.TXT",SYSCFG,parameters,defaultParameters,version;$(document).ready(function(){$.get(defaultCFG_URL,function(a){SYSCFG=a,updateParameters(),defaultParameters=parameters,displaySettings()});var a=document.getElementById("drop_area");a.addEventListener("dragover",handleDragOver,!1),a.addEventListener("drop",handleFileSelect,!1),$(".button").click(applySettings)});