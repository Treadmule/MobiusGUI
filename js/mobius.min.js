function handleDragOver(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy",$("#drop_area").addClass("drag")}function handleDragLeave(){$("#drop_area").removeClass("drag")}function handleFileSelect(a){a.stopPropagation(),a.preventDefault();var b=a.dataTransfer.files,c=b[0],d=new FileReader;d.onloadend=function(a){if(a.target.readyState==FileReader.DONE)if(SYSCFG=a.target.result,updateParameters(),-1!=$.inArray(version,acceptedFirmware)){$("#drop_area span").removeClass("red"),$("#drop_area span").addClass("green"),$("#drop_area span").text("File loaded successfully - firmware version "+version/100),displaySettings(),userLoaded=1;for(var b=0;b<acceptedFirmware.length;b++)version>=acceptedFirmware[b]?($(".getting_started").hide(),$("[data-minFw="+acceptedFirmware[b]+"]").fadeIn()):$("[data-minFw="+acceptedFirmware[b]+"]").hide()}else alert("The file you loaded was not generated by firmware v0.59 or higher.\nPlease update your camera and try again!"),parameters=defaultParameters,$("#drop_area span").removeClass("green"),$("#drop_area span").addClass("red"),$("#drop_area span").text("Wrong firmware version!")},d.readAsText(c)}function applySettings(){for(var a=0;a<parameters.length;a++){var b=$("[name="+a+"]");if(b.is("[type=radio]")){var c=$("[name="+a+"]:checked").val();(1==a||3==a)&&(prameterIndex=a+1,4==$("[name="+a+"]:checked").val()&&(c=3,fpsValue=1,changeParameter(prameterIndex,fpsValue)),$("[name="+a+"]:checked").val()<4&&(fpsValue=2,changeParameter(prameterIndex,fpsValue))),changeParameter(a,c)}if(b.is("[type=number]")){var c=b.val();parseInt(b.attr("min"))<=parseInt(c)&&parseInt(c)<=parseInt(b.attr("max"))?changeParameter(a,c):(b.val(defaultParameters[a]),whatswrong=b.closest("div").siblings().text(),alert("One or more values entered for "+whatswrong+"\nare out of the acceptable range.\nI will replace it with the default value.\n\nThe range is: ["+b.attr("min")+";"+b.attr("max")+"]"))}}var d=parseInt($("[name=video1Flip]:checked").val()),e=2*parseInt($("[name=video2Flip]:checked").val()),f=d+e;changeParameter(12,f),SaveSYSCFG()}function displaySettings(){for(var a=0;a<parameters.length;a++)checkMinMax(a),0!=$("[name="+a+"]").length&&($("[name="+a+"]").is("[type=radio]")&&($("[name="+a+"]")[parameters[a]].checked=!0),$("[name="+a+"]").is("[type=number]")&&$("[name="+a+"]").val(parameters[a]));switch(3==parameters[1]&&1==parameters[2]&&($("[name=1]")[4].checked=!0),3==parameters[3]&&1==parameters[4]&&($("[name=3]")[4].checked=!0),parameters[12]){case"0":$("[name=video1Flip]")[0].checked=!0,$("[name=video2Flip]")[0].checked=!0;break;case"1":$("[name=video1Flip]")[1].checked=!0,$("[name=video2Flip]")[0].checked=!0;break;case"2":$("[name=video1Flip]")[0].checked=!0,$("[name=video2Flip]")[1].checked=!0;break;case"3":$("[name=video1Flip]")[1].checked=!0,$("[name=video2Flip]")[1].checked=!0}}function changeParameter(a,b){var c=0;SYSCFG=SYSCFG.replace(/[^[]+(?=\])/g,function(d){return c++,c==a+1?b:d})}function SaveSYSCFG(){if(1==userLoaded){var a=new Blob([SYSCFG],{type:"text/plain;charset=utf-8"});saveAs(a,"SYSCFG.TXT")}else alert("You haven't successfully loaded a SYSCFG.TXT file, please also make sure your camera has firmware 0.59 or higher")}function updateParameters(){parameters=SYSCFG.match(/[^[]+(?=\])/g),version=SYSCFG.match(/v[^{]+(?=\})/g),version=parseInt(version[0].substring(1).replace(".",""),10),console.log(version)}function updateDate(){var a=new Date,b=a.getFullYear(),c=a.getMonth(),d=a.getDate(),e=a.getHours(),f=a.getMinutes();c=c+1+"",d+="",e+="",f+="",1==c.length&&(c="0"+c),1==d.length&&(d="0"+d),1==e.length&&(e="0"+e),1==f.length&&(f="0"+f);var g=[b,"/",c,"/",d,"-",e,":",f,":","00"].join("");changeParameter(0,g)}function checkMinMax(a){switch(maxvalue=10,minvalue=0,a){case 2:case 4:maxvalue=2,minvalue=1;break;case 12:maxvalue=3}0!=$("[name="+a+"]").length&&($("[name="+a+"]").attr("maxval")?(maxvalue=parseInt($("[name="+a+"]").attr("maxval")),minvalue=parseInt($("[name="+a+"]").attr("minval"))):$("[name="+a+"]").attr("max")?(maxvalue=parseInt($("[name="+a+"]").attr("max")),minvalue=parseInt($("[name="+a+"]").attr("min"))):(maxvalue=$("[name="+a+"]").length-1,minvalue=0)),(parameters[a]>maxvalue||parameters[a]<minvalue)&&(parameters[a]=defaultParameters[a],console.log("wrong"+a),alert("One or more parameters from your SYSCFG.TXT file are out of their acceptable range.\nI'll use defaults instead."))}var defaultCFG_URL="syscfg/SYSCFG.TXT",SYSCFG,parameters,defaultParameters,version,userLoaded,acceptedFirmware=[59,113];$(document).ready(function(){$.get(defaultCFG_URL,function(a){SYSCFG=a,updateParameters(),defaultParameters=parameters,displaySettings()});var a=document.getElementById("drop_area");a.addEventListener("dragover",handleDragOver,!1),a.addEventListener("dragleave",handleDragLeave,!1),a.addEventListener("drop",handleFileSelect,!1),$(".button").click(applySettings),$("[data-minFw=59]").hide(),$("[data-minFw=113]").hide()});